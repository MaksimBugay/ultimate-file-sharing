var e,t;e=this,t=function(e){"use strict";var t,n=new Uint8Array(16);function r(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(n)}var i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function a(e){return"string"==typeof e&&i.test(e)}for(var o,s,c=[],l=0;l<256;++l)c.push((l+256).toString(16).substr(1));function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n}var u=0,h=0;function f(e){if(!a(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}function p(e,t,n){function r(e,r,i,a){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=f(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o=new Uint8Array(16+e.length);if(o.set(r),o.set(e,r.length),(o=n(o))[6]=15&o[6]|t,o[8]=63&o[8]|128,i){a=a||0;for(var s=0;s<16;++s)i[a+s]=o[s];return i}return d(o)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function y(e){return 14+(e+64>>>9<<4)+1}function E(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function w(e,t,n,r,i,a){return E((o=E(E(t,e),E(r,a)))<<(s=i)|o>>>32-s,n);var o,s}function m(e,t,n,r,i,a,o){return w(t&n|~t&r,e,t,i,a,o)}function I(e,t,n,r,i,a,o){return w(t&r|n&~r,e,t,i,a,o)}function S(e,t,n,r,i,a,o){return w(t^n^r,e,t,i,a,o)}function g(e,t,n,r,i,a,o){return w(n^(t|~r),e,t,i,a,o)}var R=p("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r="0123456789abcdef",i=0;i<n;i+=8){var a=e[i>>5]>>>i%32&255,o=parseInt(r.charAt(a>>>4&15)+r.charAt(15&a),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[y(t)-1]=t;for(var n=1732584193,r=-271733879,i=-1732584194,a=271733878,o=0;o<e.length;o+=16){var s=n,c=r,l=i,d=a;n=m(n,r,i,a,e[o],7,-680876936),a=m(a,n,r,i,e[o+1],12,-389564586),i=m(i,a,n,r,e[o+2],17,606105819),r=m(r,i,a,n,e[o+3],22,-1044525330),n=m(n,r,i,a,e[o+4],7,-176418897),a=m(a,n,r,i,e[o+5],12,1200080426),i=m(i,a,n,r,e[o+6],17,-1473231341),r=m(r,i,a,n,e[o+7],22,-45705983),n=m(n,r,i,a,e[o+8],7,1770035416),a=m(a,n,r,i,e[o+9],12,-1958414417),i=m(i,a,n,r,e[o+10],17,-42063),r=m(r,i,a,n,e[o+11],22,-1990404162),n=m(n,r,i,a,e[o+12],7,1804603682),a=m(a,n,r,i,e[o+13],12,-40341101),i=m(i,a,n,r,e[o+14],17,-1502002290),n=I(n,r=m(r,i,a,n,e[o+15],22,1236535329),i,a,e[o+1],5,-165796510),a=I(a,n,r,i,e[o+6],9,-1069501632),i=I(i,a,n,r,e[o+11],14,643717713),r=I(r,i,a,n,e[o],20,-373897302),n=I(n,r,i,a,e[o+5],5,-701558691),a=I(a,n,r,i,e[o+10],9,38016083),i=I(i,a,n,r,e[o+15],14,-660478335),r=I(r,i,a,n,e[o+4],20,-405537848),n=I(n,r,i,a,e[o+9],5,568446438),a=I(a,n,r,i,e[o+14],9,-1019803690),i=I(i,a,n,r,e[o+3],14,-187363961),r=I(r,i,a,n,e[o+8],20,1163531501),n=I(n,r,i,a,e[o+13],5,-1444681467),a=I(a,n,r,i,e[o+2],9,-51403784),i=I(i,a,n,r,e[o+7],14,1735328473),n=S(n,r=I(r,i,a,n,e[o+12],20,-1926607734),i,a,e[o+5],4,-378558),a=S(a,n,r,i,e[o+8],11,-2022574463),i=S(i,a,n,r,e[o+11],16,1839030562),r=S(r,i,a,n,e[o+14],23,-35309556),n=S(n,r,i,a,e[o+1],4,-1530992060),a=S(a,n,r,i,e[o+4],11,1272893353),i=S(i,a,n,r,e[o+7],16,-155497632),r=S(r,i,a,n,e[o+10],23,-1094730640),n=S(n,r,i,a,e[o+13],4,681279174),a=S(a,n,r,i,e[o],11,-358537222),i=S(i,a,n,r,e[o+3],16,-722521979),r=S(r,i,a,n,e[o+6],23,76029189),n=S(n,r,i,a,e[o+9],4,-640364487),a=S(a,n,r,i,e[o+12],11,-421815835),i=S(i,a,n,r,e[o+15],16,530742520),n=g(n,r=S(r,i,a,n,e[o+2],23,-995338651),i,a,e[o],6,-198630844),a=g(a,n,r,i,e[o+7],10,1126891415),i=g(i,a,n,r,e[o+14],15,-1416354905),r=g(r,i,a,n,e[o+5],21,-57434055),n=g(n,r,i,a,e[o+12],6,1700485571),a=g(a,n,r,i,e[o+3],10,-1894986606),i=g(i,a,n,r,e[o+10],15,-1051523),r=g(r,i,a,n,e[o+1],21,-2054922799),n=g(n,r,i,a,e[o+8],6,1873313359),a=g(a,n,r,i,e[o+15],10,-30611744),i=g(i,a,n,r,e[o+6],15,-1560198380),r=g(r,i,a,n,e[o+13],21,1309151649),n=g(n,r,i,a,e[o+4],6,-145523070),a=g(a,n,r,i,e[o+11],10,-1120210379),i=g(i,a,n,r,e[o+2],15,718787259),r=g(r,i,a,n,e[o+9],21,-343485551),n=E(n,s),r=E(r,c),i=E(i,l),a=E(a,d)}return[n,r,i,a]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(y(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))}));function A(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function b(e,t){return e<<t|e>>>32-t}var O=p("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var i=0;i<r.length;++i)e.push(r.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var a=e.length/4+2,o=Math.ceil(a/16),s=new Array(o),c=0;c<o;++c){for(var l=new Uint32Array(16),d=0;d<16;++d)l[d]=e[64*c+4*d]<<24|e[64*c+4*d+1]<<16|e[64*c+4*d+2]<<8|e[64*c+4*d+3];s[c]=l}s[o-1][14]=8*(e.length-1)/Math.pow(2,32),s[o-1][14]=Math.floor(s[o-1][14]),s[o-1][15]=8*(e.length-1)&4294967295;for(var u=0;u<o;++u){for(var h=new Uint32Array(80),f=0;f<16;++f)h[f]=s[u][f];for(var p=16;p<80;++p)h[p]=b(h[p-3]^h[p-8]^h[p-14]^h[p-16],1);for(var y=n[0],E=n[1],w=n[2],m=n[3],I=n[4],S=0;S<80;++S){var g=Math.floor(S/20),R=b(y,5)+A(g,E,w,m)+I+t[g]+h[S]>>>0;I=m,m=w,w=b(E,30)>>>0,E=y,y=R}n[0]=n[0]+y>>>0,n[1]=n[1]+E>>>0,n[2]=n[2]+w>>>0,n[3]=n[3]+m>>>0,n[4]=n[4]+I>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}));e.NIL="00000000-0000-0000-0000-000000000000",e.parse=f,e.stringify=d,e.v1=function(e,t,n){var i=t&&n||0,a=t||new Array(16),c=(e=e||{}).node||o,l=void 0!==e.clockseq?e.clockseq:s;if(null==c||null==l){var f=e.random||(e.rng||r)();null==c&&(c=o=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==l&&(l=s=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:Date.now(),y=void 0!==e.nsecs?e.nsecs:h+1,E=p-u+(y-h)/1e4;if(E<0&&void 0===e.clockseq&&(l=l+1&16383),(E<0||p>u)&&void 0===e.nsecs&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=p,h=y,s=l;var w=(1e4*(268435455&(p+=122192928e5))+y)%4294967296;a[i++]=w>>>24&255,a[i++]=w>>>16&255,a[i++]=w>>>8&255,a[i++]=255&w;var m=p/4294967296*1e4&268435455;a[i++]=m>>>8&255,a[i++]=255&m,a[i++]=m>>>24&15|16,a[i++]=m>>>16&255,a[i++]=l>>>8|128,a[i++]=255&l;for(var I=0;I<6;++I)a[i+I]=c[I];return t||d(a)},e.v3=R,e.v4=function(e,t,n){var i=(e=e||{}).random||(e.rng||r)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=i[a];return t}return d(i)},e.v5=O,e.validate=a,e.version=function(e){if(!a(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).uuid={});const n=Object.freeze({MB:1048576,MB_ENC:1155625,MB10:10485760,MB100:104857600,GB:1073741824});function r(e){return new Promise((t=>setTimeout(t,e)))}function i(){const e=/Mobi|Android/i.test(navigator.userAgent),t=window.innerWidth<=800&&window.innerHeight<=1280,n="ontouchstart"in window||navigator.maxTouchPoints>0;return e&&t&&n}function a(e,...t){return e.replace(/{(\d+)}/g,(function(e,n){return void 0!==t[n]?t[n]:e}))}function o(e){const t=(new TextEncoder).encode(e);let n=0;for(const e of t)n=31*n+(255&e),n|=0;return n}function s(e){const t=new ArrayBuffer(4);new DataView(t).setInt32(0,e,!1);const n=new Int8Array(t);return Array.from(n)}function c(e){if(4!==e.byteLength)throw new Error("Invalid byte array length. Must be 4 bytes.");return new DataView(e).getInt32(0,!1)}function l(e){if(e<0||e>255)throw new RangeError("Integer must be in the range 0 to 255.");const t=new Uint8Array(1);return t[0]=e,t}function d(e){if(1!==e.byteLength)throw new Error(`Invalid byte array length ${e.byteLength}. Must be 1 byte.`);return new DataView(e).getInt8(0)}function u(e,t,n){if(t<0||n>e.byteLength||t>n)throw new RangeError("Invalid start or end index.");return e.slice(t,n)}function h(e){return null!=e&&void 0!==e&&""!==e}function f(e){return!h(e)}function p(e){return null!=e&&Array.isArray(e)&&e.length>0}const y={},E=Object.freeze({SUCCESS:"SUCCESS",ERROR:"ERROR"});class w{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class m{constructor(e,t){this.type=e,this.body=t}}function I(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return window.btoa(t)}y.releaseWaiterWithSuccess=function(e,t){e.resolve(new m(E.SUCCESS,t))},y.releaseWaiterWithError=function(e,t){e.reject(new m(E.ERROR,t))},y.waitingHall=new Map,y.addToWaitingHall=function(e){let t=new w;return y.waitingHall.set(e,t),t.promise},y.releaseWaiterIfExistsWithSuccess=function(e,t){let n=y.waitingHall.get(e);return!!n&&(y.releaseWaiterWithSuccess(n,t),y.waitingHall.delete(e),!0)},y.releaseWaiterIfExistsWithError=function(e,t){let n=y.waitingHall.get(e);n&&(y.releaseWaiterWithError(n,t),y.waitingHall.delete(e))},y.callAsynchronouslyWithRepeatOfFailure=async function(e,t,n,r,i=!1){let a;for(let o=0;o<n;o++){if(i&&G.uploadBinaryLimitWasReached)return new m(E.ERROR,"uploadBinaryLimitWasReached");if(a=await y.callAsynchronously(e,t,r),E.SUCCESS===a.type)return a}return a},y.callAsynchronously=async function(e,t,n){const r=e||1e3,i=t||uuid.v4().toString();let a;"function"==typeof n&&n(i);try{a=await Promise.race([y.addToWaitingHall(i),(o=r,new Promise(((e,t)=>{setTimeout((()=>t(new Error("Timeout after "+o+" ms"))),o)})))])}catch(e){y.waitingHall.delete(i),a=new m(E.ERROR,e)}var o;return a},Object.freeze({DENIED:"DENIED",ERROR:"ERROR"});const S=["workSpaceId","accountId","deviceId","applicationId"],g=Object.freeze({PING:"PING",ACKNOWLEDGE:"ACKNOWLEDGE",SEND_MESSAGE:"SEND_MESSAGE",SEND_MESSAGE_WITH_ACKNOWLEDGE:"SEND_MESSAGE_WITH_ACKNOWLEDGE",ADD_MEMBERS_TO_CHANNEL:"ADD_MEMBERS_TO_CHANNEL",SEND_MESSAGE_TO_CHANNEL:"SEND_MESSAGE_TO_CHANNEL",GET_CHANNEL_HISTORY:"GET_CHANNEL_HISTORY",REMOVE_ME_FROM_CHANNEL:"REMOVE_ME_FROM_CHANNEL",GET_CHANNELS:"GET_CHANNELS",GET_CHANNELS_PUBLIC_INFO:"GET_CHANNELS_PUBLIC_INFO",MARK_CHANNEL_AS_READ:"MARK_CHANNEL_AS_READ",GET_IMPRESSION_STAT:"GET_IMPRESSION_STAT",ADD_IMPRESSION:"ADD_IMPRESSION",REMOVE_IMPRESSION:"REMOVE_IMPRESSION",SEND_UPLOAD_BINARY_APPEAL:"SEND_UPLOAD_BINARY_APPEAL",SEND_DELETE_BINARY_APPEAL:"SEND_DELETE_BINARY_APPEAL",SEND_BINARY_MANIFEST:"SEND_BINARY_MANIFEST",SEND_GATEWAY_RESPONSE:"SEND_GATEWAY_RESPONSE",SEND_GATEWAY_REQUEST:"SEND_GATEWAY_REQUEST",CONNECTION_ALIAS_LOOKUP:"CONNECTION_ALIAS_LOOKUP",CAPTCHA_VERIFY:"CAPTCHA_VERIFY",PUZZLE_CAPTCHA_GENERATE_AND_SEND:"PUZZLE_CAPTCHA_GENERATE_AND_SEND",PUZZLE_CAPTCHA_VERIFY_SELECTED_OPTION:"PUZZLE_CAPTCHA_VERIFY_SELECTED_OPTION",PUZZLE_CAPTCHA_VERIFY:"PUZZLE_CAPTCHA_VERIFY"}),R=Object.freeze({ACKNOWLEDGE:"ACKNOWLEDGE",RESPONSE:"RESPONSE",CHANNEL_MESSAGE:"CHANNEL_MESSAGE",CHANNEL_EVENT:"CHANNEL_EVENT",UPLOAD_BINARY_APPEAL:"UPLOAD_BINARY_APPEAL",BINARY_MANIFEST:"BINARY_MANIFEST",GATEWAY_REQUEST:"GATEWAY_REQUEST",PRIVATE_URL_SUFFIX:"PRIVATE_URL_SUFFIX",CONNECTION_ALIAS:"CONNECTION_ALIAS",HUMAN_TOKEN:"HUMAN_TOKEN"}),A=(Object.freeze({CHANNEL:"CHANNEL",CHANNEL_MESSAGE:"CHANNEL_MESSAGE"}),"@@");class b{constructor(e,t){this.id=e,this.name=t}}class O{constructor(e,t,n,r,i,a,o,s){this.workSpaceId=e,this.accountId=t,this.deviceId=n,i&&(this.deviceId=JSON.stringify({deviceId:n,avatarCode:i,webSite:s,signatureHash:o,modalView:a,time:(new Date).getTime()})),this.applicationId=r}hashCode(){return o(a("{0}@@{1}@@{2}@@{3}",this.workSpaceId,this.accountId,this.deviceId,this.applicationId))}equals(e){return this.hashCode()===e.hashCode()}toJSON(e){return e?{workSpaceId:this.workSpaceId,accountId:this.accountId,deviceId:this.deviceId,applicationId:this.applicationId,findAny:!0===e}:{workSpaceId:this.workSpaceId,accountId:this.accountId,deviceId:this.deviceId,applicationId:this.applicationId}}cloneWithoutDeviceId(){return new O(this.workSpaceId,this.accountId,null,this.applicationId)}cloneAndReplaceDeviceId(e){return new O(this.workSpaceId,this.accountId,e,this.applicationId)}}class C{constructor(e,t,n,r,i){this.workSpaceId=e,this.accountId=t,this.deviceId=n,this.applicationId=r,this.active=i}shortPrint(){return h(this.active)&&this.active?this.accountId+"[+]":this.accountId+"[-]"}}class v{constructor(e,t,n,r,i){this.channel=e,this.members=t,this.counter=n,this.time=r,this.read=i}static fromObject(e){const t=new b(e.channel.id,e.channel.name);let n=[];return e.members&&(n=e.members.map((e=>new C(e.workSpaceId,e.accountId,e.deviceId,e.applicationId,e.active)))),new v(t,n,e.counter,e.time,e.read)}}class N{constructor(e){this.channels=e}static fromWsResponse(e){const t=("string"==typeof e?JSON.parse(e):e).body.channels.map((e=>v.fromObject(e)));return new N(t)}}class _{constructor(e,t){this.code=e,this.counter=t}static fromObject(e){return new _(e.code,e.counter)}shortPrint(){return this.code+": "+this.counter}}class W{constructor(e,t){this.resourceId=e,this.counters=t}static fromObject(e){const t=e.counters.map((e=>_.fromObject(e)));return new W(e.resourceId,t)}}class T{constructor(e){this.items=e}static fromWsResponse(e){const t=("string"==typeof e?JSON.parse(e):e).body.map((e=>W.fromObject(e)));return new T(t)}}class L{constructor(e,t,n,r){this.messages=e,this.offset=t,this.latest=n,this.more=r}static fromWsResponse(e){const t="string"==typeof e?JSON.parse(e):e,n=t.body.messages.map((e=>k.fromObject(e)));return new L(n,t.body.offset,t.body.latest,t.body.more)}}class P{constructor(e){this.id=e}static fromWsResponse(e){const t=("string"==typeof e?JSON.parse(e):e).body.messageId;return new P(t)}}class M{constructor(e,t,n,r,i){this.type=e,this.actor=t,this.channelId=n,this.filters=r,this.time=i}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,n=new O(t.actor.workSpaceId,t.actor.accountId,t.actor.deviceId,t.actor.applicationId);let r=[];return t.filters&&(r=t.filters.map((e=>new O(e.workSpaceId,e.accountId,e.deviceId,e.applicationId)))),new M(t.type,n,t.channelId,r,t.time)}}class k{constructor(e,t,n,r,i,a,o){this.sender=e,this.channelId=t,this.messageId=n||uuid.v4().toString(),this.parentId=r,this.sendTime=i||Date.now(),this.body=a,this.mentioned=o}static fromObject(e){const t=new O(e.sender.workSpaceId,e.sender.accountId,e.sender.deviceId,e.sender.applicationId);let n=[];return p(e.mentioned)&&(n=e.mentioned.map((e=>new O(e.workSpaceId,e.accountId,e.deviceId,e.applicationId)))),new k(t,e.channelId,e.messageId,e.parentId,e.sendTime,e.body,n)}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return this.fromObject(t)}}class H{constructor(e,t){this.id=e,this.message=t}}class U{constructor(e,t,n,r){this.client=e,this.pusherInstanceId=n,this.apiKey=r,this.mobile=t}}class D{constructor(e,t,n,r){this.pusherInstanceId=e,this.externalAdvertisedUrl=t,this.internalAdvertisedUrl=n,this.browserAdvertisedUrl=r}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return new D(t.pusherInstanceId,t.externalAdvertisedUrl,t.internalAdvertisedUrl,t.browserAdvertisedUrl)}}class x{constructor(e,t,r,i,a,o){this.sender=e,this.owner=t,this.binaryId=r,this.chunkSize=i||n.MB,this.manifestOnly=a,this.requestedChunks=o}static fromObject(e){const t=new O(e.sender.workSpaceId,e.sender.accountId,e.sender.deviceId,e.sender.applicationId),n=new O(e.owner.workSpaceId,e.owner.accountId,e.owner.deviceId,e.owner.applicationId);return new x(t,n,e.binaryId,e.chunkSize,e.manifestOnly,e.requestedChunks)}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return this.fromObject(t)}}class B{constructor(e,t,n,r,i,a,o,s,c,l){this.alias=e,this.client=t,this.roles=n||[],this.ip=r,this.latitude=i,this.longitude=a,this.countryCode=o,this.countryName=s,this.city=c,this.proxyInfo=l}static fromObject(e){const t=new O(e.client.workSpaceId,e.client.accountId,e.client.deviceId,e.client.applicationId);return new B(e.alias,t,e.roles,e.ip,e.latitude,e.longitude,e.countryCode,e.countryName,e.city,e.proxyInfo)}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return this.fromObject(t)}}class F{constructor(e,t,n,r,i,a,o,s,c){this.client=e,this.alias=t,this.ip=n,this.latitude=r,this.longitude=i,this.countryCode=a,this.countryName=o,this.city=s,this.proxyInfo=c}static fromObject(e){const t=new O(e.body.client.workSpaceId,e.body.client.accountId,e.body.client.deviceId,e.body.client.applicationId);return new F(t,e.body.alias,e.body.ip,e.body.latitude,e.body.longitude,e.body.countryCode,e.body.countryName,e.body.city,e.body.proxyInfo)}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return this.fromObject(t)}}let G={};function z(){G.refreshBrokenConnectionIntervalId&&(window.clearInterval(G.refreshBrokenConnectionIntervalId),G.refreshBrokenConnectionIntervalId=null)}G.clusterBaseUrl="https://secure.fileshare.ovh",G.serverBaseUrl="http://localhost:8080",G.pusherInstanceId=null,G.verbose=!1,G.uploadBinaryLimitWasReached=!1,G.onOpenHandler=null,G.onCloseHandler=null,G.onMessageHandler=null,G.onChannelEventHandler=null,G.onChannelMessageHandler=null,G.onHumanTokenHandler=null,G.onDataHandler=null,G.onFileTransferChunkHandler=null,G.onCaptchaSetHandler=null,G.onPuzzleCaptchaSetHandler=null,G.onUploadBinaryAppealHandler=null,G.onBinaryManifestHandler=null,G.onFinalizedBinaryHandler=null,G.executeWithRepeatOnFailure=async function(e,t,n,r){if(f(G.ws))return new m(E.ERROR,"Web socket connection does not exists");if(G.ws.readyState!==window.WebSocket.OPEN){const e=`WebSocket is not open. State: ${G.ws.readyState}`;return new m(E.ERROR,e)}let i=r||3,a=n||5e3,o=e||t.id;return await y.callAsynchronouslyWithRepeatOfFailure(a,o,i,(function(e){G.ws.send(t.message)}))},G.buildCommandMessage=function(e,t){let n,r=uuid.v4().toString();return n=t?`${r}${A}${e}${A}${JSON.stringify(t)}`:`${r}${A}${e}`,new H(r,n)},G.openWebSocket=function(e,t,n){try{G.ws=new window.WebSocket(G.wsUrl)}catch(e){G.ws=null,"function"==typeof t&&t(e)}G.ws&&(G.ws.binaryType="arraybuffer",G.ws.onopen=function(){"function"==typeof e&&e(),"function"==typeof G.onOpenHandler&&G.onOpenHandler(G.ws)},G.ws.onmessage=function(e){if(e.data instanceof ArrayBuffer){const t=e.data;if(13===t.byteLength)return void G.ws.send(t);const n=new $(t);n.withAcknowledge&&G.sendAcknowledge(n.getId());const i=y.releaseWaiterIfExistsWithSuccess(te(n.getId()),n.payload),a=y.releaseWaiterIfExistsWithSuccess(ne(n.getId()),n.payload);if(!i&&!a){const e=K.get(te(n.binaryId));e&&j.FILE===n.binaryType?e.setChunkBytes(n.order,n.payload).then((()=>{e.isFinalized()&&"function"==typeof G.onFinalizedBinaryHandler&&(G.onFinalizedBinaryHandler(e),r(9e5).then((()=>{K.delete(e.id)})))})):j.FILE_TRANSFER===n.binaryType?"function"==typeof G.onFileTransferChunkHandler&&G.onFileTransferChunkHandler(n):j.CAPTCHA_SET===n.binaryType?"function"==typeof G.onCaptchaSetHandler&&G.onCaptchaSetHandler(n):j.PUZZLE_CAPTCHA_SET===n.binaryType&&"function"==typeof G.onPuzzleCaptchaSetHandler&&G.onPuzzleCaptchaSetHandler(n)}return void("function"==typeof G.onDataHandler&&G.onDataHandler(e.data))}if("PONG"===e.data)return void G.verbose;let t=e.data.split(A);if(t[1]!==R.ACKNOWLEDGE){if(t[1]===R.RESPONSE){let e;return t.length>2&&(e=t[2]),void y.releaseWaiterIfExistsWithSuccess(t[0],e)}if(t[1]!==R.CHANNEL_EVENT)if(t[1]!==R.CHANNEL_MESSAGE)if(t[1]!==R.CONNECTION_ALIAS)if(t[1]!==R.HUMAN_TOKEN){if(t[1]===R.UPLOAD_BINARY_APPEAL)return async function(e){const t=new O(e.sender.workSpaceId,e.sender.accountId,e.sender.deviceId,e.sender.applicationId);!async function(e,t,n,r){const i=q(r.workSpaceId,r.accountId,r.deviceId,r.applicationId);if(p(n)){for(let t=0;t<n.length;t++)await ee(e,n[t],i,!1);return}let a,o=await y.callAsynchronously(2e3,null,(function(t){getManifest(e,(function(e){y.releaseWaiterIfExistsWithSuccess(t,e)}),(function(e){y.releaseWaiterIfExistsWithError(t,e.target.error)}))}));if(E.SUCCESS===o.type&&o.body&&(a=o.body),a){if(a.setPusherInstanceId(G.pusherInstanceId),a.setSender(G.ClientObj),t)return await G.sendBinaryManifest(r,a),void incrementDownloadCounterOfManifestRecord(a.id);for(let t=0;t<a.datagrams.length;t++)await ee(e,t,i,!0)}}(e.binaryId,e.manifestOnly,e.requestedChunks,t)}(x.fromJSON(t[2])),void("function"==typeof G.onUploadBinaryAppealHandler&&G.onUploadBinaryAppealHandler(x.fromJSON(t[2])));if(t[1]===R.BINARY_MANIFEST){G.sendAcknowledge(t[0]);const e=J.fromJSON(t[2]),n=te(e.id);return y.releaseWaiterIfExistsWithSuccess(n,e)||K.get(n)||K.set(n,e),void("function"==typeof G.onBinaryManifestHandler&&G.onBinaryManifestHandler(J.fromJSON(t[2])))}if(t[1]===R.GATEWAY_REQUEST){const e=t[2],n=B.fromJSON(t[3]);let r=new Uint8Array(0);return 5===t.length&&(r=function(e){const t=window.atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r.buffer}(t[4])),void processGateWayRequest(e,n,r,(function(e){let n=new Uint8Array(0);e&&(n=e),G.sendGatewayResponse(t[0],n)}))}if(2===t.length)return G.sendAcknowledge(t[0]),void("function"==typeof G.onMessageHandler&&G.onMessageHandler(G.ws,t[1]));"function"==typeof G.onMessageHandler&&G.onMessageHandler(G.ws,e.data)}else"function"==typeof G.onHumanTokenHandler&&G.onHumanTokenHandler(t[2]);else y.releaseWaiterIfExistsWithSuccess(t[2],t[3]);else"function"==typeof G.onChannelMessageHandler&&G.onChannelMessageHandler(k.fromJSON(t[2]));else"function"==typeof G.onChannelEventHandler&&G.onChannelEventHandler(M.fromJSON(t[2]))}else y.releaseWaiterIfExistsWithSuccess(t[0],null)},G.ws.onerror=function(e){"function"==typeof t&&t(e)},G.ws.onclose=function(e){"function"==typeof n&&n(),e.wasClean,"function"==typeof G.onCloseHandler&&G.onCloseHandler(G.ws,e)})},G.stopWebSocket=function(){z(),G.ws&&G.ws.readyState!==window.WebSocket.CLOSING&&G.ws.readyState!==window.WebSocket.CLOSED&&G.ws.close(3e3,"Stop websocket connection")},G.isOpen=function(){return!!G.ws&&G.ws.readyState===window.WebSocket.OPEN},G.openWsConnection=async function(e,t,n,a,o=null){G.serverBaseUrl=e,G.ClientObj=t,a||function(e,t){z(),r(5e3).then((()=>{G.refreshBrokenConnectionIntervalId=window.setInterval((function(){if(G.ws&&G.ws.readyState===window.WebSocket.OPEN)K.forEach(((e,t)=>{e.isExpired()&&K.delete(t)}));else if(G.ClientObj){let n=100;G.ws&&G.ws.readyState!==window.WebSocket.CLOSING&&G.ws.readyState!==window.WebSocket.CLOSED&&(G.ws.close(3e3,"Close broken connection before recovery"),n=2e3),r(n).then((()=>{let n;n="function"==typeof t?t(G.ClientObj):function(e){const t=JSON.parse(e.deviceId);return new O(e.workSpaceId,e.accountId,JSON.stringify({deviceId:t.deviceId,avatarCode:t.avatarCode,webSite:t.webSite,signatureHash:t.signatureHash,modalView:t.modalView,time:(new Date).getTime()}),e.applicationId)}(G.ClientObj),G.openWsConnection(e,n,t,!0)}))}}),5e3)}))}(e,n);let s=await async function(e,t,n){const a=new U(t,i(),null,n),o=`${e}/sign-in/${function(e){const t=(new TextEncoder).encode(e),n=String.fromCharCode.apply(null,t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(JSON.stringify(a))}`;return await y.callAsynchronously(3e3,null,(function(e){const t=new WebSocket(o);t?(t.onmessage=function(t){try{const n=D.fromJSON(t.data);G.pusherInstanceId=n.pusherInstanceId,y.releaseWaiterIfExistsWithSuccess(e,n.browserAdvertisedUrl)}catch(t){y.releaseWaiterIfExistsWithError(e,t)}},t.onerror=function(t){y.releaseWaiterIfExistsWithError(e,t)},t.onclose=function(t){r(500).then((()=>{y.releaseWaiterIfExistsWithError(e,"Failed public sign-in attempt")}))}):y.releaseWaiterIfExistsWithError(e,"Impossible to create web socket")}))}(e,t,o);if(E.ERROR!==s.type&&s.body)return G.wsUrl=s.body,await y.callAsynchronously(3e3,null,(function(e){G.openWebSocket((function(){y.releaseWaiterIfExistsWithSuccess(e,window.WebSocket.OPEN)}),(function(t){y.releaseWaiterIfExistsWithError(e,t)}),(function(){y.releaseWaiterIfExistsWithError(e,window.WebSocket.CLOSED)}))}))},G.changeClientObject=function(e){if(G.ws&&G.ws.readyState===window.WebSocket.OPEN&&G.ClientObj&&G.ClientObj.equals(e))return null;const t=G.ClientObj;return G.ClientObj=e,G.ws&&G.ws.close(1e3,"leave"),t},G.sendAcknowledge=function(e){let t={};t.messageId=e;let n=G.buildCommandMessage(g.ACKNOWLEDGE,t);G.ws.send(n.message)},G.sendGatewayRequest=async function(e,t,n){let r={};r.receiver=e.toJSON(!1),r.preserveOrder=!1,r.path=t,r.payload=I(n);let i=G.buildCommandMessage(g.SEND_GATEWAY_REQUEST,r),a=await G.executeWithRepeatOnFailure(null,i,3e4);return E.ERROR===a.type?null:a.body},G.sendGatewayResponse=function(e,t){let n={};n.id=e,n.payload=I(t);let r=G.buildCommandMessage(g.SEND_GATEWAY_RESPONSE,n);G.ws.send(r.message)},G.broadcastMessage=async function(e,t,n,r){let i={};i.id=e,i.filter=t,i.sender=G.client,i.message=r,i.preserveOrder=n;let a=G.buildCommandMessage(g.SEND_MESSAGE,i),o=await G.executeWithRepeatOnFailure(null,a);E.ERROR,o.type},G.sendMessageWithAcknowledge=async function(e,t,n,r){if(i=t,!S.every((e=>i.hasOwnProperty(e)&&null!==i[e]&&void 0!==i[e]&&""!==i[e])))return;var i;let a={};a.id=e,a.client=t,a.sender=G.ClientObj,a.message=r,a.preserveOrder=n;let o=G.buildCommandMessage(g.SEND_MESSAGE_WITH_ACKNOWLEDGE,a),s=await G.executeWithRepeatOnFailure(e,o);E.ERROR,s.type},G.addMembersToChannel=async function(e,t){let n={};n.channel=e,n.filters=t;let r=G.buildCommandMessage(g.ADD_MEMBERS_TO_CHANNEL,n),i=await G.executeWithRepeatOnFailure(null,r);return E.ERROR!==i.type},G.sendMessageToChannel=async function(e,t,n){let r={};r.channel=e,p(t)&&(r.mentioned=t),r.message=n;let i=G.buildCommandMessage(g.SEND_MESSAGE_TO_CHANNEL,r),a=await G.executeWithRepeatOnFailure(null,i);return E.ERROR===a.type?null:P.fromWsResponse(a.body)},G.getChannelHistory=async function(e,t){let n={};n.channel=e,t&&(n.offset=t);let r=G.buildCommandMessage(g.GET_CHANNEL_HISTORY,n),i=await G.executeWithRepeatOnFailure(null,r);return E.ERROR===i.type?null:L.fromWsResponse(i.body)},G.removeMeFromChannel=async function(e){let t={};t.channel=e;let n=G.buildCommandMessage(g.REMOVE_ME_FROM_CHANNEL,t),r=await G.executeWithRepeatOnFailure(null,n);return E.ERROR,r.type,r},G.getChannels=async function(e){let t={};t.filter=e;let n=G.buildCommandMessage(g.GET_CHANNELS,t),r=await G.executeWithRepeatOnFailure(null,n);return E.ERROR===r.type?null:N.fromWsResponse(r.body)},G.getChannelsPublicInfo=async function(e){let t={};t.ids=e;let n=G.buildCommandMessage(g.GET_CHANNELS_PUBLIC_INFO,t),r=await G.executeWithRepeatOnFailure(null,n);return E.ERROR===r.type?null:N.fromWsResponse(r.body)},G.markChannelAsRead=async function(e){let t={};t.channel=e;let n=G.buildCommandMessage(g.MARK_CHANNEL_AS_READ,t),r=await G.executeWithRepeatOnFailure(null,n);E.ERROR,r.type},G.getImpressionStat=async function(e){let t={};t.ids=e;let n=G.buildCommandMessage(g.GET_IMPRESSION_STAT,t),r=await G.executeWithRepeatOnFailure(null,n);return E.ERROR===r.type?null:T.fromWsResponse(r.body)},G.addImpression=async function(e,t){let n={};n.channel=e,n.impression=t;let r=G.buildCommandMessage(g.ADD_IMPRESSION,n),i=await G.executeWithRepeatOnFailure(null,r);E.ERROR,i.type},G.removeImpression=async function(e,t){let n={};n.channel=e,n.impression=t;let r=G.buildCommandMessage(g.REMOVE_IMPRESSION,n),i=await G.executeWithRepeatOnFailure(null,r);E.ERROR,i.type},G.sendPing=function(){let e=G.buildCommandMessage(g.PING);G.ws.send(e.message)},G.sendUploadBinaryAppeal=async function(e,t,n,r,i){let a={};a.owner=e,a.binaryId=t,a.chunkSize=n,a.manifestOnly=r,a.requestedChunks=i;let o=G.buildCommandMessage(g.SEND_UPLOAD_BINARY_APPEAL,a),s=await G.executeWithRepeatOnFailure(null,o);return E.ERROR,s.type,s},G.downloadBinaryChunk=async function(e,t,n,r){const i=q(G.ClientObj.workSpaceId,G.ClientObj.accountId,G.ClientObj.deviceId,G.ClientObj.applicationId),a=new O((s=e.workSpaceId,/^-?\d+$/.test(s.trim())?e.workSpaceId:`${o(e.workSpaceId)}`),e.accountId,null,e.applicationId);var s;const c=ne(Z(t,n,i)),l=await y.callAsynchronouslyWithRepeatOfFailure(3e4,c,3,(function(){G.sendUploadBinaryAppeal(a,t,r,!1,[n]).then((e=>{E.ERROR===e.type&&y.releaseWaiterIfExistsWithError(c,"Failed download binary chunk attempt: "+e.body)}))}));return E.ERROR===l.type?null:l.body},G.sendDeleteBinaryAppeal=async function(e,t){let n={};n.binaryId=e,n.deviceSecret=t;let r=G.buildCommandMessage(g.SEND_DELETE_BINARY_APPEAL,n),i=await G.executeWithRepeatOnFailure(null,r);return E.ERROR===i.type?JSON.stringify({body:"false",error:i.body}):i.body},G.sendBinaryManifest=async function(e,t){let n={};n.dest=e,n.manifest=t.toJSON();let r=G.buildCommandMessage(g.SEND_BINARY_MANIFEST,n),i=await G.executeWithRepeatOnFailure(t.id,r);return E.ERROR,i.type,i},G.sendBinaryChunk=async function(e,t,n,r,i){if(f(G.ws))return new m(E.ERROR,"Web socket connection does not exists");if(G.ws.readyState!==window.WebSocket.OPEN){const e=`WebSocket is not open. State: ${G.ws.readyState}`;return new m(E.ERROR,e)}const a=X(j.FILE,n,r,e,t),o=new ArrayBuffer(a.length+i.byteLength),s=new Uint8Array(o);s.set(a,0),s.set(new Uint8Array(i),a.length);const c=Z(e,t,n),l=r?1:3,d=await y.callAsynchronouslyWithRepeatOfFailure(6e4,c,l,(function(){G.ws.send(o)}));return E.ERROR,d.type,d},G.transferBinaryChunk=async function(e,t,n,r){if(f(G.ws))return new m(E.ERROR,"Web socket connection does not exists");if(G.ws.readyState!==window.WebSocket.OPEN){const e=`WebSocket is not open. State: ${G.ws.readyState}`;return new m(E.ERROR,e)}const i=X(j.FILE_TRANSFER,n,!1,e,t),a=new ArrayBuffer(i.length+r.byteLength),o=new Uint8Array(a);o.set(i,0),o.set(new Uint8Array(r),i.length);const s=Z(e,t,n),c=await y.callAsynchronouslyWithRepeatOfFailure(2e4,s,3,(function(){G.ws.send(a)}));return E.ERROR,c.type,c},G.cacheBinaryChunkInCloud=async function(e,t,n){if(f(G.ws))return new m(E.ERROR,"Web socket connection does not exists");if(G.ws.readyState!==window.WebSocket.OPEN||G.uploadBinaryLimitWasReached){const e=`WebSocket is not open. State: ${G.ws.readyState}`;return new m(E.ERROR,e)}const r=G.ClientObj.hashCode(),i=X(j.CACHE_BINARY,r,!1,e,t),a=new ArrayBuffer(i.length+n.byteLength),o=new Uint8Array(a);o.set(i,0),o.set(new Uint8Array(n),i.length);const s=Z(e,t,r),c=await y.callAsynchronouslyWithRepeatOfFailure(2e4,s,3,(function(){G.ws.send(a)}),!0);return E.ERROR,c.type,c},G.connectionAliasLookup=async function(e){let t={};t.fragment=e;let n=G.buildCommandMessage(g.CONNECTION_ALIAS_LOOKUP,t),r=await G.executeWithRepeatOnFailure(null,n);if(E.ERROR===r.type)return null;const i="string"==typeof r.body?JSON.parse(r.body):r.body;return i.error?null:F.fromObject(i)},G.CaptchaVerify=async function(e,t,n,r){let i={};i.captchaId=e,i.pageId=t,i.resultIndex=n,r&&(i.backendUrl=e);let a=G.buildCommandMessage(g.CAPTCHA_VERIFY,i),o=await G.executeWithRepeatOnFailure(null,a);E.ERROR,o.type},G.RequestPuzzleCaptcha=async function(e,t){let n={};n.captchaId=e,n.pieceSizeLength=t;let r=G.buildCommandMessage(g.PUZZLE_CAPTCHA_GENERATE_AND_SEND,n),i=await G.executeWithRepeatOnFailure(null,r);E.ERROR,i.type},G.verifySelectedPieceOfPuzzleCaptcha=async function(e,t,n,r){let i={};i.captchaId=e,i.pageId=t,i.point={x:n,y:r};let a=G.buildCommandMessage(g.PUZZLE_CAPTCHA_VERIFY_SELECTED_OPTION,i),o=await G.executeWithRepeatOnFailure(null,a,3e4);return E.ERROR===o.type?null:o.body},G.verifyPuzzleCaptcha=async function(e,t,n,r){let i={};i.captchaId=e,i.pageId=t,i.point={x:n,y:r};let a=G.buildCommandMessage(g.PUZZLE_CAPTCHA_VERIFY,i),o=await G.executeWithRepeatOnFailure(null,a,3e4);if(E.ERROR===o.type)return null},window.addEventListener("beforeunload",(function(){z(),h(G.ws)&&G.ws.close(1e3,"leave")}));const j=Object.freeze({FILE:0,MEDIA_STREAM:1,BINARY_MESSAGE:2,FILE_TRANSFER:3,CACHE_BINARY:4,PING:5,CAPTCHA_SET:6,PUZZLE_CAPTCHA_SET:7}),Y=Object.freeze({UNKNOWN:0,LOADED:1,CORRUPTED:2});class V{constructor(e,t,n){this.order=e,this.size=t,this.md5=n,this.state=Y.UNKNOWN}setBytes(e){this.bytes=e,this.state=Y.LOADED}setState(e){this.state=e}}class J{constructor(e,t,n,r,i,a,o,s,c,l,d,u,h,f,y,E){this.id=e,this.name=t,this.mimeType=n,this.readMeText=r,this.sender=i,this.pusherInstanceId=a,this.datagrams=p(o)?o:[],this.totalSize=s,this.created=c||(new Date).getTime(),this.password=l,this.privateUrlSuffix=d,this.downloadCounter=u||0,this.base64Key=h,this.base64IV=f,this.cachedInCloud=y,this.forHuman=E}getPrivateUrlShortSuffix(){return this.privateUrlSuffix?this.privateUrlSuffix.split(A)[0]:null}getPrivateUrlLongSuffix(){if(!this.privateUrlSuffix)return null;const e=this.privateUrlSuffix.split(A);return e.length>1?e[1]:null}getTotalSize(){return this.totalSize||(this.totalSize=Q(this.datagrams)),this.totalSize}resetTotalSize(){this.totalSize=null}appendDatagram(e){this.resetTotalSize(),this.datagrams.push(e),this.totalSize=Q(this.datagrams)}setSender(e){this.sender=e}setPusherInstanceId(e){this.pusherInstanceId=e}getPublicUrl(e,t){const n=G.clusterBaseUrl;let r;if(this.password){const i=t?`?workspace=${e}`:"";r=`${n}/binary/${this.getPrivateUrlShortSuffix()}${i}`}else r=`${n}/public-binary.html?w=${e}&id=${this.id}`,this.forHuman&&(r=`${r}&human-only=true`);return r}async setChunkBytes(e,t){const n=this.datagrams[e];return y.callAsynchronously(2e3,null,(function(e){(async function(e){const t=await crypto.subtle.digest("SHA-256",e),n=Array.from(new Uint8Array(t));return btoa(String.fromCharCode.apply(null,n))})(t).then((r=>{n.md5===r?(n.setBytes(t),y.releaseWaiterIfExistsWithSuccess(e,!0)):(n.setState(Y.CORRUPTED),y.releaseWaiterIfExistsWithError(e,!1))}))}))}isCompleted(){return this.datagrams.every((e=>e.state===Y.LOADED))}isFinalized(){return this.datagrams.every((e=>e.state!==Y.UNKNOWN))}isExpired(){return(new Date).getTime()-this.created>18e5}toJSON(){return{id:this.id,name:this.name,mimeType:this.mimeType,readMeText:this.readMeText,sender:this.sender,pusherInstanceId:this.pusherInstanceId,datagrams:this.datagrams}}toDbJSON(){return{id:this.id,name:this.name,mimeType:this.mimeType,readMeText:this.readMeText,sender:this.sender,pusherInstanceId:this.pusherInstanceId,datagrams:this.datagrams,password:this.password,privateUrlSuffix:this.privateUrlSuffix,base64Key:this.base64Key,base64IV:this.base64IV,cachedInCloud:this.cachedInCloud,forHuman:this.forHuman}}static fromObject(e,t,n,r){const i=new O(e.sender.workSpaceId,e.sender.accountId,e.sender.deviceId,e.sender.applicationId);let a=[];return p(e.datagrams)&&(a=e.datagrams.map((e=>new V(e.order,e.size,e.md5)))),new J(e.id,e.name,e.mimeType,e.readMeText,i,e.pusherInstanceId,a,t,n,e.password,e.privateUrlSuffix,r,e.base64Key,e.base64IV,e.cachedInCloud,e.forHuman)}static fromJSON(e,t,n,r){const i="string"==typeof e?JSON.parse(e):e;return this.fromObject(i,t,n,r)}}class ${constructor(e){this.binaryType=d(u(e,0,1)),this.destClientHash=c(u(e,1,5)),this.withAcknowledge=1===d(u(e,5,6)),this.binaryId=function(e){e=new Uint8Array(e);const t=new DataView(e.buffer),n=t.getBigUint64(0,!1),r=t.getBigUint64(8,!1),i=n.toString(16).padStart(16,"0"),a=r.toString(16).padStart(16,"0");return`${i.substring(0,8)}-${i.substring(8,12)}-${i.substring(12,16)}-${a.substring(0,4)}-${a.substring(4,16)}`}(u(e,6,22)),this.order=c(u(e,22,26)),this.payload=u(e,26,e.byteLength)}getId(){return Z(this.binaryId,this.order,this.destClientHash)}}const K=new Map;function Z(e,t,n){return`${e}-${t}-${n}`}function q(e,t,n,r){return o(a("{0}@@{1}@@{2}@@{3}",e,t,n,r))}function X(e,t,n,r,i){return function(...e){let t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t),r=0;return e.forEach((e=>{n.set(e,r),r+=e.length})),n}(l(e),s(t),l(n?1:0),function(e){const t=uuid.parse(e),n=new ArrayBuffer(16),r=new DataView(n);for(let e=0;e<16;e++)r.setUint8(e,t[e]);let i=0n,a=0n;for(let e=0;e<8;e++)i=i<<8n|BigInt(r.getUint8(e));for(let e=8;e<16;e++)a=a<<8n|BigInt(r.getUint8(e));r.setBigUint64(0,i,!1),r.setBigUint64(8,a,!1);const o=new Int8Array(n);return Array.from(o)}(r),s(i))}function Q(e){return p(e)?e.reduce(((e,t)=>e+t.size),0):0}async function ee(e,t,n,r){const i=await y.callAsynchronously(2e3,null,(function(n){getBinaryChunk(e,t,(function(e){y.releaseWaiterIfExistsWithSuccess(n,e)}))}));if(E.ERROR===i.type||!i.body)return;const a=await i.body.arrayBuffer();return await G.sendBinaryChunk(e,t,n,r,a)}function te(e){return`wd_${e}`}function ne(e){return`wds_${e}`}const re={serverUrl:"https://secure.fileshare.ovh",wsUrl:"wss://secure.fileshare.ovh:31085"};re.captchaId=uuid.v4().toString(),re.pageId=uuid.v4().toString(),re.backendUrl=null,re.blocked=!1,re.embedded=!1,re.loaded=!1,re.correctOptionWasSelected=!1,re.startPoint={x:0,y:0},re.pieceStartPoint={x:0,y:0};const ie=new URLSearchParams(window.location.search);ie.get("page-id")&&(re.pageId=ie.get("page-id"),re.embedded=!0),ie.get("backend-url")&&(re.backendUrl=ie.get("backend-url")),ie.get("piece-length")?re.pieceLength=ie.get("piece-length"):re.pieceLength=180,ie.get("hide-task")?re.showTask="true"!==ie.get("hide-task"):re.showTask=!0,ie.get("skip-demo")?re.skipDemo="true"===ie.get("skip-demo"):re.skipDemo=!1;const ae=document.getElementById("displayCaptchaContainer"),oe=document.getElementById("puzzleCaptchaArea"),se=document.getElementById("selectedCaptchaPiece"),ce=document.getElementById("errorMessage"),le=document.getElementById("brandNameDiv");async function de(e,t){e&&e.remove(),t.remove(),le.style.display="flex",await ge()}function i(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||navigator.maxTouchPoints&&navigator.maxTouchPoints>1||window.innerWidth<=500}function ue(e){let t,n;return e.touches&&e.touches.length>0?(t=e.touches[0].clientX,n=e.touches[0].clientY):e.changedTouches&&e.changedTouches.length>0?(t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY):(t=e.clientX||e.pageX,n=e.clientY||e.pageY),{x:t,y:n}}window.addEventListener("DOMContentLoaded",(async function(){le.title="Task: Find the shape in the bottom section that exactly matches the shape at the top.\nInstructions: Drag the matching shape onto the top shape until it fully overlaps (100% alignment).";const e=document.getElementById("puzzleCaptchaDemo"),t=document.getElementById("captchaHint");if(re.showTask){if(re.skipDemo)return e.remove(),t&&(t.style.display="flex",await r(3e3),t.remove()),le.style.display="flex",void await ge();t&&(t.style.display="none"),e.style.display="flex",e.addEventListener("error",(function(n){de(t,e)})),e.querySelector("source").addEventListener("error",(function(){de(t,e)})),e.addEventListener("play",(function(){t&&t.remove()})),e.addEventListener("ended",(async function(){e.remove(),le.style.display="flex",await ge()}))}else await de(t,e)}));let he=50,fe=!1,pe=0;function ye(){return function(e){if(e.isTrusted&&re.correctOptionWasSelected){fe=!0,document.body.classList.add("dragging");const{x:t,y:n}=ue(e),r=t-10,i=n-10;se.style.display="block",se.style.left=r-20+"px",se.style.top=i-he+"px",se.style.pointerEvents="none";const a=se.getBoundingClientRect();re.pieceStartPoint={x:a.left,y:a.top},re.correctOptionWasSelected=!1,e.preventDefault(),e.stopPropagation()}}}function Ee(){return function(e){if(!e.isTrusted)return;if(!fe)return;const t=Date.now();if(t-pe<16)return;pe=t;const{x:n,y:r}=ue(e),i=n-10,a=r-10;requestAnimationFrame((()=>{se.style.left=i-20+"px",se.style.top=a-he+"px"})),e.preventDefault(),e.stopPropagation()}}function we(){return async function(e){if(!fe)return;if(fe=!1,!e.isTrusted)return;document.body.classList.remove("dragging");const t=se.getBoundingClientRect();se.style.display="none",se.style.pointerEvents="auto";const n=Math.round(re.startPoint.x+(t.left-re.pieceStartPoint.x))-10,i=Math.round(re.startPoint.y+(t.top-re.pieceStartPoint.y))-10;try{await G.verifyPuzzleCaptcha(re.captchaId,re.pageId,n-20,i-he)}catch(e){}await r(2e3),G.isOpen()&&Se(),e.preventDefault(),e.stopPropagation()}}function me(){return async function(e){const t=this.getBoundingClientRect();let n,r;if(e.touches&&e.touches.length>0){const i=e.touches[0];n=i.clientX-t.left,r=i.clientY-t.top}else n=e.clientX-t.left,r=e.clientY-t.top;n*=this.width/t.width,r*=this.height/t.height,re.startPoint={x:n,y:r};try{const e=await G.verifySelectedPieceOfPuzzleCaptcha(re.captchaId,re.pageId,n,r);re.correctOptionWasSelected="true"===JSON.parse(e).body}catch(e){re.correctOptionWasSelected=!1}e.preventDefault(),e.stopPropagation(),re.correctOptionWasSelected?ye()(e):Se()}}function Ie(){!function(){const e=document.createElement("style");e.textContent="\n        #puzzleCaptchaArea, #selectedCaptchaPiece {\n            touch-action: none;\n            -webkit-user-select: none;\n            user-select: none;\n            -webkit-touch-callout: none;\n            -webkit-tap-highlight-color: transparent;\n        }\n        body.dragging {\n            overflow: hidden;\n            position: fixed;\n            width: 100%;\n            -webkit-overflow-scrolling: touch;\n        }\n        * {\n            -webkit-touch-callout: none;\n            -webkit-user-select: none;\n            -khtml-user-select: none;\n            -moz-user-select: none;\n            -ms-user-select: none;\n            user-select: none;\n        }\n    ",document.head.appendChild(e)}(),function(){if(i()){document.body.style.touchAction="none",document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.webkitTouchCallout="none",he=100;let e=0;document.addEventListener("touchend",(function(t){const n=(new Date).getTime();n-e<=300&&t.preventDefault(),e=n}),!1),document.addEventListener("touchstart",(function(e){e.touches.length>1&&e.preventDefault()}),{passive:!1}),document.addEventListener("gesturestart",(function(e){e.preventDefault()}),{passive:!1})}}(),function(){const e={passive:!1};document.addEventListener("touchstart",(function(e){e.preventDefault(),ye()(e)}),e),document.addEventListener("touchmove",(function(e){e.preventDefault(),Ee()(e)}),e),document.addEventListener("touchend",(async function(e){e.preventDefault(),await we()(e)}),e),document.addEventListener("touchcancel",(async function(e){e.preventDefault(),await we()(e)}),e),document.addEventListener("mousedown",ye()),document.addEventListener("mousemove",Ee()),document.addEventListener("mouseup",we()),document.addEventListener("contextmenu",(function(e){fe&&e.preventDefault()})),document.addEventListener("selectstart",(function(e){fe&&e.preventDefault()})),document.addEventListener("dragstart",(function(e){e.preventDefault()}))}(),le&&le.addEventListener("click",(function(){window.open("https://sl-st.com","_blank")})),r(6e4).then((()=>{Se()}))}function Se(){G.stopWebSocket(),ae.style.display="none",ce.textContent="You can try better next time!",ce.style.display="block",r(1500).then((()=>{const e=new URL(window.location.href);e.searchParams.set("hide-task","true"),window.location.href=e.toString()}))}async function ge(){if(!G.isOpen()){const e=new O("SecureFileShare","dynamic-captcha",re.embedded?uuid.v4().toString():re.pageId,"PUZZLE_CAPTCHA_APP");await G.openWsConnection(re.wsUrl,e,(function(e){return new O(e.workSpaceId,e.accountId,e.deviceId,e.applicationId)}))}}function r(e){return new Promise((t=>setTimeout(t,e)))}G.onOpenHandler=async function(){for(await G.RequestPuzzleCaptcha(re.captchaId,re.pieceLength);!re.loaded;)await r(100);if(await r(300),"string"==typeof(e=ae)&&(e=document.querySelector(e)),!function(e,t){t||(t={});const n="number"==typeof t.threshold?t.threshold:1,r="number"==typeof t.rootMargin?t.rootMargin:0,i=function(e){if(!e||!e.getBoundingClientRect)return null;const t=e.getBoundingClientRect(),n=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),i=Math.max(0,t.left),a=Math.max(0,t.top),o=Math.min(n,t.right),s=Math.min(r,t.bottom),c=Math.max(0,o-i),l=Math.max(0,s-a),d=t.width||t.right-t.left,u=t.height||t.bottom-t.top;if(d<=0||u<=0)return{rect:t,visibilityRatio:0,visibilityPercentage:0,isVisible:!1,viewportWidth:n,viewportHeight:r};const h=c*l/(d*u);return{rect:t,visibilityRatio:h,visibilityPercentage:Math.round(100*h),isVisible:h>0,viewportWidth:n,viewportHeight:r}}(e);if(!i)return!1;if(0!==r){const e={top:i.rect.top+r,left:i.rect.left+r,bottom:i.rect.bottom-r,right:i.rect.right-r};return e.top>=0&&e.left>=0&&e.bottom<=i.viewportHeight&&e.right<=i.viewportWidth&&i.visibilityRatio>=n}return i.visibilityRatio>=n}(e)&&140!==re.pieceLength){const e=new URL(window.location.href);e.searchParams.set("piece-length","140"),window.location.href=e.toString()}var e},G.onHumanTokenHandler=function(e){G.stopWebSocket(),ae.style.display="none",ce.textContent=`Congratulations! You've successfully proven your humanity and unlocked your unique human token ${e}. Amazing job!`,re.embedded||(ce.style.display="block"),r(1500).then((()=>{location.reload()}))},G.onPuzzleCaptchaSetHandler=async function(e){const t=e.payload,n=new Blob([t],{type:"image/png"}),r=URL.createObjectURL(n);if(re.loaded)se.src=r,se.onload=function(){URL.revokeObjectURL(r)},se.onerror=function(){URL.revokeObjectURL(r)};else{const e=oe.getContext("2d"),t=new Image;t.onload=function(){oe.width=t.naturalWidth,oe.height=t.naturalHeight;const n=Math.min(.9*window.innerWidth,t.naturalWidth)/t.naturalWidth;oe.style.width=t.naturalWidth*n+"px",oe.style.height=t.naturalHeight*n+"px",e.drawImage(t,0,0),URL.revokeObjectURL(r),i()?oe.addEventListener("touchstart",me(),{passive:!1}):oe.addEventListener("mousedown",me()),re.loaded=!0},t.onerror=function(){URL.revokeObjectURL(r)},t.src=r}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Ie):Ie();